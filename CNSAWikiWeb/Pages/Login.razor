@page "/login"
@using CNSAWiki.Data
@inject AuthService Auth
@inject NavigationManager Nav

<PageTitle>Login</PageTitle>

<h3>Login Page</h3>

<input @bind="username" placeholder="ID" />
<input @bind="password" type="password" placeholder="PW" />

<button @onclick="LoginFunc">Login</button>
<button @onclick="LogoutFunc">Logout</button>

@if (!string.IsNullOrEmpty(failMessage))
{
    <p style="color:red">@failMessage</p>
}

@if (Auth.Authorized)
{
    <p style="color:green">로그인 성공! 사용자: @Auth.Username</p>
    <button @onclick="GetMyInfo">내 정보 보기</button>
    <p>@myInfo</p>
}

@code {
    string username = "";
    string password = "";
    string? failMessage;
    string myInfo = "";

    private async Task LoginFunc()
    {
        failMessage = null;
        bool ok = await Auth.LoginAsync(username, password);
        if (!ok)
        {
            failMessage = "로그인 실패. 아이디/비밀번호 확인.";
            return;
        }
        StateHasChanged();
    }

    private async Task LogoutFunc()
    {
        await Auth.LogoutAsync();
        StateHasChanged();
    }

    private void GetMyInfo()
    {
        myInfo = $"내 아이디: {Auth.Username}";
        StateHasChanged();
    }
}
