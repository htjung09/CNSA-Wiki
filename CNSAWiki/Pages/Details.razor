@page "/wiki/details/{Id:long}"
@using CNSAWiki.Models;
@using CNSAWiki.Data;
@inject AuthService Auth
@inject HttpClient Http

<h2>@wiki?.Title</h2>

@if (wiki == null)
{
    <p>Loading...</p>
}
else
{
    <div>@wiki.Content</div>
    <p>Created: @wiki.CreatedAt.ToLocalTime()</p>
    <p>Updated: @wiki.UpdatedAt.ToLocalTime()</p>
    @if (Auth.Authorized && wiki.AuthorId == Auth.UserId)
    {
        <button @onclick="NavToEdit">Edit</button>
    }
}

@code {
    [Parameter] public long Id { get; set; }

    private WikiPage? wiki;

    protected override async Task OnInitializedAsync()
    {
        wiki = await Http.GetFromJsonAsync<WikiPage>($"api/wiki/{Id}");
    }

    [Inject] NavigationManager Navigation { get; set; } = null!;

    void NavToEdit()
    {
        if (wiki == null) return; 
        Navigation.NavigateTo($"/wiki/edit/{wiki.PageId}");
    }
}
