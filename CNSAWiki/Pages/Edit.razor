@page "/wiki/edit/{Id:long}"
@using CNSAWiki.Data;
@inject AuthService Auth
@inject HttpClient Http
@inject NavigationManager Navigation
@using CNSAWiki.Models;

<h2>@(Id == 0 ? "새 문서 작성" : "문서 편집")</h2>

@if (wiki == null)
{
    <p>Loading...</p>
}
else
{
    <input @bind="wiki.Title" placeholder="Title" />
    <textarea @bind="wiki.Content" rows="10" cols="50"></textarea>
    <button @onclick="Save">Save</button>
    <button @onclick="Cancel">Cancel</button>
}

@code {
    [Parameter] public long Id { get; set; }

    private WikiPage wiki = new WikiPage();

    protected override async Task OnInitializedAsync()
    {
        if (Id != 0)
        {
            wiki = await Http.GetFromJsonAsync<WikiPage>($"api/wiki/{Id}") ?? new WikiPage();
        }
    }

    private async Task Save()
    {
        wiki.AuthorId = Auth.UserId;
        if (Id == 0)
        {
            await Http.PostAsJsonAsync("api/wiki", wiki);
        }
        else
        {
            await Http.PutAsJsonAsync($"api/wiki/{Id}", wiki);
        }

        Navigation.NavigateTo("/wiki");
    }

    private void Cancel()
    {
        Navigation.NavigateTo("/wiki");
    }
}
